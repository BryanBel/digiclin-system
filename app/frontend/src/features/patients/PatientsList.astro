
---
---

<ul id="patients-list" class="m-0 p-2 list-none overflow-auto flex flex-col gap-8 rounded-md border border-gray-300 h-full">
  <li id="loading-state" class="text-gray-500 p-4 text-center">
    Cargando pacientes...
  </li>
</ul>

<script>
  import PatientsModule, { patients } from "./patientsModule";

  const patientsList = document.querySelector('#patients-list');
  
  // Fetch initial data and handle potential errors
  try {
    // This will populate the 'patients' store, which triggers the subscription below
    await PatientsModule.getPatients();
  } catch (error) {
    // If the API fails (e.g., server is down, unauthorized), show an error message
    console.error("Failed to fetch patients:", error);
    if (patientsList) patientsList.innerHTML = `<li class="text-red-500 p-4 text-center">Error al cargar los pacientes.</li>`;
  }

  // Subscribe to changes in the patients store
  patients.subscribe(allPatients => {
    if (!patientsList) return;

    const fragment = document.createDocumentFragment();

    if (allPatients.length === 0) {
        const noPatientsLi = document.createElement('li');
        noPatientsLi.textContent = 'No se encontraron pacientes.';
        noPatientsLi.className = 'text-gray-500 p-4';
        fragment.appendChild(noPatientsLi);
    } else {
      // Render each patient
      for (const patient of allPatients) {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `/patients/${patient.id}`;
        // Apply styles to make it look like a clickable list item
        link.className = 'block p-4 border-b -mb-8 list-none flex justify-between items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150';
        link.innerHTML = `<span class="patient-name font-medium text-gray-800 dark:text-gray-200">${patient.name}</span>`;
        
        li.appendChild(link);
        fragment.appendChild(li);
      }
    }
    // Replace the list content efficiently in one operation
    patientsList.replaceChildren(fragment);
  });
</script>
