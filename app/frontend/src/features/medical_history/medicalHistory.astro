---
export interface Props {
  patientId: string;
}
const { patientId } = Astro.props;
---
<div class="p-4 border border-gray-300 rounded-md">
  <h3 class="text-xl font-bold mb-4">Medical History</h3>
  <ul id="history-list" class="space-y-4">
    <!-- History items will be rendered here by the script -->
  </ul>
</div>

<script>
  import MedicalHistoryModule, { history } from './medicalHistoryModule.js';

  // The patientId is passed from the component's props
  const patientId = Astro.props.patientId;
  const historyList = document.querySelector('#history-list');

  // Fetch initial data
  await MedicalHistoryModule.getHistoryForPatient(patientId);

  // Subscribe to changes
  history.subscribe(records => {
    if (!historyList) return;
    historyList.innerHTML = ''; // Clear previous entries

    if (records.length === 0) {
      historyList.innerHTML = '<li class="text-gray-500">No medical history found.</li>';
      return;
    }

    for (const record of records) {
      const li = document.createElement('li');
      li.className = 'p-3 border rounded-md bg-gray-50';
      li.innerHTML = `
        <p><strong>Treatment:</strong> ${record.treatment}</p>
        <p><strong>Information:</strong> ${record.medical_inform}</p>
        <p><strong>Recipe:</strong> ${record.recipe}</p>
      `;
      historyList.appendChild(li);
    }
  });
</script>